{
  "name": "ifthenpay Moodle Dev",
  "dockerComposeFile": ["../docker-compose.yml"],
  "service": "dev",
  "workspaceFolder": "/workspace",
  "shutdownAction": "none",
  "customizations": {
    "vscode": {
      "settings": {
        // PHP validation & IntelliSense
        "php.validate.enable": true,
        "php.validate.executablePath": "/usr/local/bin/php",
        "intelephense.environment.phpVersion": "8.2",
        "intelephense.format.enable": true,

        // Formatting (global defaults)
        "editor.formatOnSave": true,
        "editor.defaultFormatter": "esbenp.prettier-vscode",
        "[php]": {
          "editor.defaultFormatter": "bmewburn.vscode-intelephense-client"
        },

        // Avoid formatter conflicts: let ESLint/Stylelint handle JS/CSS fixes
        "[javascript]": {
          "editor.defaultFormatter": "dbaeumer.vscode-eslint"
        },
        // CSS: rely on Stylelint code actions instead of Prettier formatting
        "[css]": {
          "editor.formatOnSave": false
        },
        // Keep Prettier for non-code docs
        "[json]": { "editor.defaultFormatter": "esbenp.prettier-vscode" },
        "[markdown]": { "editor.defaultFormatter": "esbenp.prettier-vscode" },

        // Auto-fix on save (ESLint + Stylelint + imports)
        "editor.codeActionsOnSave": {
          "source.fixAll.eslint": "always",
          "source.fixAll.stylelint": "always",
          "source.organizeImports": "always"
        },

        // ESLint & Stylelint integration
        "eslint.validate": ["javascript"],
        "eslint.format.enable": true,
        "eslint.useFlatConfig": true,
        "stylelint.validate": ["css"],

        // PHPCS, PHPStan, PHPMD via phpsab
        "phpSniffer.enable": true,
        "phpSniffer.executablePath": "${workspaceFolder}/vendor/bin/phpcs",
        "phpSniffer.standard": "phpcs.xml",

        // Terminal
        "terminal.integrated.defaultProfile.linux": "bash",
        "php.suggest.basic": false,
        "editor.snippetSuggestions": "top"
      },
      "extensions": [
        // Linters & formatters
        "dbaeumer.vscode-eslint",
        "stylelint.vscode-stylelint",
        "esbenp.prettier-vscode",

        // PHP tooling
        "bmewburn.vscode-intelephense-client",
        "xdebug.php-debug",
        "valeryan.vscode-phpsab",
        "hakcorp.php-awesome-snippets",

        // Utilities
        "editorconfig.editorconfig",
        "ms-azuretools.vscode-docker"
      ]
    }
  },
  "forwardPorts": [8080, 8081, 9003],
  "postCreateCommand": "cd plugin && composer install --no-interaction && npm install",
  "postStartCommand": "bash plugin/.devcontainer/post-start.sh"
}
