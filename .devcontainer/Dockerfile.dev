FROM mcr.microsoft.com/vscode/devcontainers/php:8.2

# Align with Bitnami runtime UID/GID to avoid permission issues on the shared volume
USER root
ARG TARGET_UID=1001
ARG TARGET_GID=1001
RUN (getent group ${TARGET_GID} || groupadd -g ${TARGET_GID} bitnami) \
  && usermod -u ${TARGET_UID} -g ${TARGET_GID} vscode \
  && chown -R ${TARGET_UID}:${TARGET_GID} /home/vscode

# Node 20 LTS + grunt-cli for JS builds
RUN apt-get update \
  && apt-get install -y curl ca-certificates gnupg \
  && curl -fsSL https://deb.nodesource.com/setup_20.x | bash - \
  && apt-get install -y nodejs \
  && npm -g config set fund false audit false \
  && npm -g install grunt-cli \
  && rm -rf /var/lib/apt/lists/*

USER vscode
WORKDIR /workspace
